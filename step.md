# TETRIS 시스템 재구조화 단계별 실행 계획서

## 🎯 프로젝트 목표
현재 분리되어 있는 `app.py` (웹 인터페이스)와 `tetris.py` (AI 처리)를 통합하여 `tetris.py`를 메인 진입점으로 하는 통합 시스템 구축

## 📋 전체 진행 단계 개요

| Phase | 작업 내용 | 예상 시간 | 우선순위 | 의존성 |
|-------|-----------|-----------|----------|--------|
| 1 | 웹 인터페이스 모듈화 | 2-3시간 | 높음 | 없음 |
| 2 | 모듈 구조 재정리 | 1-2시간 | 높음 | Phase 1 |
| 3 | tetris.py 통합 인터페이스 | 3-4시간 | 중간 | Phase 2 |
| 4 | 파일 구조 재정리 | 2-3시간 | 중간 | Phase 3 |
| 5 | 설정 및 환경 통합 | 1시간 | 낮음 | Phase 4 |
| 6 | 테스트 및 검증 | 2-3시간 | 높음 | Phase 5 |

**총 예상 시간**: 11-16시간

---

## 🚀 Phase 1: 웹 인터페이스 모듈화 (2-3시간)

### 📝 목표
- `app.py`를 `web_interface/web.py`로 이동
- `user_input.py`를 `web_interface/user/`로 분리
- Blueprint 기반 라우팅 구조 구현

### 📋 세부 작업 목록

#### Step 1.1: 디렉토리 구조 준비 (30분)
- [ ] `tetris/web_interface/` 디렉토리 확인
- [ ] `control/`, `user/`, `source/` 서브디렉토리 확인
- [ ] 필요한 `__init__.py` 파일 생성

#### Step 1.2: app.py 분석 및 분리 (45분)
- [ ] `app.py` 코드 분석 및 기능 분류
- [ ] 관제 화면 관련 코드 식별 → `control/routes.py`
- [ ] 사용자 입력 관련 코드 식별 → `user/routes.py`
- [ ] 공통 기능 식별 → `source/`

#### Step 1.3: Blueprint 구조 구현 (60분)
- [ ] `control/__init__.py` - control_bp Blueprint 생성
- [ ] `user/__init__.py` - user_bp Blueprint 생성
- [ ] `control/routes.py` - 관제 화면 라우팅 구현
- [ ] `user/routes.py` - 사용자 입력 라우팅 구현

#### Step 1.4: 메인 웹 서버 생성 (45분)
- [ ] `web_interface/web.py` 생성
- [ ] Flask 앱 생성 및 Blueprint 등록
- [ ] 기본 설정 및 미들웨어 구성

### ✅ 완료 기준
- [ ] `python tetris/web_interface/web.py` 실행 시 웹 서버 정상 동작
- [ ] 관제 화면 (`/desktop/control`) 접근 가능
- [ ] 사용자 입력 화면 (`/mobile/input`) 접근 가능
- [ ] 기존 기능 동일하게 동작

---

## ⚙️ Phase 2: 모듈 구조 재정리 (1-2시간)

### 📝 목표
- `main_chain/`, `rpi_controller/` 루트 레벨로 이동
- `user_input/` → `web_interface/`로 통합
- import 경로 수정

### 📋 세부 작업 목록

#### Step 2.1: 모듈 이동 (30분)
- [ ] `tetris/main_chain/` → `tetris/main_chain/` (이미 올바른 위치)
- [ ] `tetris/rpi_controller/` → `tetris/rpi_controller/` (이미 올바른 위치)
- [ ] `tetris/user_input/` → `tetris/web_interface/user_input/`로 이동

#### Step 2.2: import 경로 수정 (45분)
- [ ] 모든 Python 파일의 import 경로 검토
- [ ] 상대 경로를 절대 경로로 변경
- [ ] 순환 import 문제 해결

#### Step 2.3: 의존성 정리 (15분)
- [ ] `requirements.txt` 업데이트
- [ ] 불필요한 의존성 제거
- [ ] 새로운 의존성 추가

### ✅ 완료 기준
- [ ] 모든 모듈이 올바른 위치에 배치
- [ ] import 오류 없음
- [ ] 기존 기능 정상 동작

---

## 🔗 Phase 3: tetris.py 통합 인터페이스 (3-4시간)

### 📝 목표
- 웹 모드 실행 로직 구현
- AI 체인 및 하드웨어 제어 통합
- 실시간 통신 시스템 통합

### 📋 세부 작업 목록

#### Step 3.1: 메인 진입점 설계 (60분)
- [ ] `tetris.py`에 명령행 인자 파싱 추가
- [ ] 웹 모드와 시나리오 모드 분기 로직 구현
- [ ] 설정 파일 로드 기능 추가

#### Step 3.2: 웹 모드 통합 (90분)
- [ ] `web_interface/web.py` 호출 로직 구현
- [ ] 웹 서버 시작/중지 관리
- [ ] 포트 및 호스트 설정 통합

#### Step 3.3: AI 체인 통합 (60분)
- [ ] `main_chain/main_chain.py` 호출 인터페이스 구현
- [ ] 시나리오 모드 실행 로직 구현
- [ ] AI 처리 결과 반환 로직 구현

#### Step 3.4: 하드웨어 제어 통합 (30분)
- [ ] `rpi_controller/rpi_controller.py` 호출 인터페이스 구현
- [ ] 하드웨어 초기화 및 정리 로직 구현

### ✅ 완료 기준
- [ ] `python tetris/tetris.py --mode web` 실행 시 웹 서버 시작
- [ ] `python tetris/tetris.py --mode scenario` 실행 시 AI 처리 시작
- [ ] 모든 모듈이 통합된 상태로 정상 동작

---

## 📁 Phase 4: 파일 구조 재정리 (2-3시간)

### 📝 목표
- 디렉토리 구조 재편성
- 정적 파일 경로 수정
- 템플릿 구조 정리

### 📋 세부 작업 목록

#### Step 4.1: 정적 파일 이동 (60분)
- [ ] `static/` → `tetris/web_interface/source/static/`로 이동
- [ ] CSS, JS, 이미지 파일 경로 수정
- [ ] 템플릿에서 정적 파일 참조 경로 수정

#### Step 4.2: 템플릿 구조 정리 (60분)
- [ ] `templates/` → `tetris/web_interface/source/templates/`로 이동
- [ ] 템플릿 파일들을 영역별로 분류
- [ ] 템플릿 상속 구조 정리

#### Step 4.3: 세션 및 업로드 디렉토리 정리 (30분)
- [ ] `session_storage/` → `tetris/web_interface/source/session_storage/`로 이동
- [ ] `static/uploads/` → `tetris/web_interface/source/uploads/`로 이동
- [ ] 파일 경로 참조 수정

#### Step 4.4: 설정 파일 통합 (30분)
- [ ] 환경별 설정 파일 생성
- [ ] 데이터베이스 연결 설정 통합
- [ ] 로깅 설정 통합

### ✅ 완료 기준
- [ ] 모든 파일이 올바른 위치에 배치
- [ ] 웹 페이지에서 정적 파일 정상 로드
- [ ] 템플릿 렌더링 정상 동작
- [ ] 파일 업로드 및 세션 저장 정상 동작

---

## ⚙️ Phase 5: 설정 및 환경 통합 (1시간)

### 📝 목표
- 통합 설정 파일 생성
- 환경 변수 관리 통합
- 로깅 시스템 통합

### 📋 세부 작업 목록

#### Step 5.1: 설정 파일 생성 (30분)
- [ ] `tetris/config.py` 생성
- [ ] 웹, AI, 하드웨어 설정 통합
- [ ] 환경별 설정 분리 (dev, prod)

#### Step 5.2: 로깅 시스템 통합 (30분)
- [ ] 통합 로깅 설정 구현
- [ ] 모듈별 로그 레벨 설정
- [ ] 로그 파일 관리

### ✅ 완료 기준
- [ ] 모든 모듈이 통합 설정 사용
- [ ] 환경별 설정 정상 동작
- [ ] 로깅 시스템 정상 동작

---

## 🧪 Phase 6: 테스트 및 검증 (2-3시간)

### 📝 목표
- 재구조화된 시스템 테스트
- 웹 모드 동작 확인
- 시나리오 모드 동작 확인

### 📋 세부 작업 목록

#### Step 6.1: 단위 테스트 (60분)
- [ ] 각 모듈별 단위 테스트 실행
- [ ] import 경로 테스트
- [ ] 기본 기능 테스트

#### Step 6.2: 통합 테스트 (90분)
- [ ] 웹 모드 전체 플로우 테스트
- [ ] 시나리오 모드 전체 플로우 테스트
- [ ] 하드웨어 제어 테스트

#### Step 6.3: 성능 테스트 (30분)
- [ ] 메모리 사용량 측정
- [ ] 응답 시간 측정
- [ ] 동시 접속 테스트

### ✅ 완료 기준
- [ ] 모든 테스트 통과
- [ ] 기존 기능과 동일한 성능
- [ ] 새로운 구조에서 정상 동작 확인

---

## 🚨 주의사항 및 리스크 관리

### ⚠️ 주요 주의사항
1. **백업 필수**: 작업 시작 전 전체 프로젝트 백업
2. **단계별 검증**: 각 Phase 완료 후 반드시 테스트
3. **점진적 진행**: 한 번에 모든 것을 변경하지 말고 단계별로 진행
4. **의존성 관리**: import 순환 참조 문제 주의

### 🔧 롤백 계획
- 각 Phase 완료 시점에서 백업 생성
- 문제 발생 시 이전 Phase로 롤백 가능
- Git 브랜치를 활용한 버전 관리

### 📊 진행 상황 추적
- [ ] Phase 1 완료 체크리스트
- [ ] Phase 2 완료 체크리스트  
- [ ] Phase 3 완료 체크리스트
- [ ] Phase 4 완료 체크리스트
- [ ] Phase 5 완료 체크리스트
- [ ] Phase 6 완료 체크리스트

---

## 🎯 최종 목표 달성 기준

### ✅ 성공 기준
1. **단일 진입점**: `python tetris/tetris.py --mode web`로 웹 서버 실행
2. **모듈 분리**: control/user/source 영역 명확히 분리
3. **기능 보존**: 기존 모든 기능 정상 동작
4. **성능 유지**: 기존과 동일하거나 더 나은 성능
5. **유지보수성**: 코드 구조 개선 및 문서화

### 📈 예상 개선 효과
- **개발 효율성**: 50% 향상
- **코드 중복**: 50% 감소
- **테스트 용이성**: 80% 향상
- **유지보수성**: 60% 향상

---

## 🚀 시작 준비 체크리스트

### 사전 준비
- [ ] 현재 프로젝트 전체 백업
- [ ] Git 저장소 상태 확인
- [ ] 개발 환경 설정 확인
- [ ] 테스트 환경 준비

### 시작 조건
- [ ] 사용자 승인 확인
- [ ] 작업 시간 확보
- [ ] 롤백 계획 수립
- [ ] 진행 상황 추적 방법 결정

**준비 완료 시 Phase 1부터 시작 가능합니다.**

