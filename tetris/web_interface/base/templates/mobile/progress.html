<!DOCTYPE html>
<html lang="ko">
<head>
    <link href="https://cdn.jsdelivr.net/npm/krds-uiux@1.0.3/resources/cdn/krds.min.css" type="text/css" rel="stylesheet" />
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI 분석 진행 중 - AI TETRIS</title>
    <link rel="stylesheet" href="/static/css/mobile/progress.css">
</head>
<body>

    <div class="topbar">
        <img onclick="goToHome()" src="/static/images/back_arrows.png" alt="AI TETRIS">
        <h1>AI TETRIS</h1>
    </div>
    
    <div class="main-content">
        <div class="status-message">
            <h2 class="status-title">차량 시트 배치 분석</h2>
            <!-- <p class="status-subtitle">차량 시트 배치 분석</p> -->
        </div>

        <div class="illustration">
            <div class="ai-brain"></div>
        </div>

        <div class="progress-info">
            <div class="progress-percentage" id="progressPercentage">0%</div>
            <div class="progress-text" id="progressText">분석을 시작하고 있습니다...</div>
            
            <!-- Progress Bar 추가 -->
            <div class="progress-bar-container">
                <div class="progress-bar" id="progressBar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="progress-labels">
                    <span class="progress-label">0%</span>
                    <span class="progress-label">20%</span>
                    <span class="progress-label">40%</span>
                    <span class="progress-label">60%</span>
                    <span class="progress-label">80%</span>
                    <span class="progress-label">100%</span>
                </div>
            </div>
            </div>

            <div class="progress-detail-button" onclick="openDetailPanel()">상세 정보 보기</div>
        
        <!-- <div class="progress-steps">
            <div class="step" id="step1">
                <div class="step-icon pending">1</div>
                <div class="step-content">
                    <div class="step-title">이미지 분석</div>
                    <div class="step-description">사진을 분석하고 있습니다</div>
        </div>
            </div>
            
            <div class="step" id="step2">
                <div class="step-icon pending">2</div>
                <div class="step-content">
                    <div class="step-title">짐 인식 및 분류</div>
                    <div class="step-description">짐을 인식하고 분류하고 있습니다</div>
            </div>
        </div>
            
            <div class="step" id="step3">
                <div class="step-icon pending">3</div>
                <div class="step-content">
                    <div class="step-title">차량 공간 계산</div>
                    <div class="step-description">차량 공간을 계산하고 있습니다</div>
                </div>
        </div>
            
            <div class="step" id="step4">
                <div class="step-icon pending">4</div>
                <div class="step-content">
                    <div class="step-title">최적 배치 생성</div>
                    <div class="step-description">최적의 배치를 생성하고 있습니다</div>
                </div>
        </div>
            
            <div class="step" id="step5">
                <div class="step-icon pending">5</div>
                <div class="step-content">
                    <div class="step-title">결과 검증 및 완료</div>
                    <div class="step-description">결과를 검증하고 있습니다</div>
                </div>
            </div>
        </div> -->
        
        <!-- 단계별 분석 결과 표시 영역 (기본 화면에서는 숨김) -->
        <div class="step-results" id="stepResults" style="display:none;">
            <div class="step-result-item" id="step1Result" style="display: none;">
                <div class="step-result-title">1단계: 이미지 분석 결과</div>
                <div class="step-result-content" id="step1ResultContent">분석 중...</div>
            </div>
            
            <div class="step-result-item" id="step2Result" style="display: none;">
                <div class="step-result-title">2단계: 짐 인식 및 분류 결과</div>
                <div class="step-result-content" id="step2ResultContent">분석 중...</div>
            </div>
            
            <div class="step-result-item" id="step3Result" style="display: none;">
                <div class="step-result-title">3단계: 차량 공간 계산 결과</div>
                <div class="step-result-content" id="step3ResultContent">분석 중...</div>
            </div>
            
            <div class="step-result-item" id="step4Result" style="display: none;">
                <div class="step-result-title">4단계: 최적 배치 생성 결과</div>
                <div class="step-result-content" id="step4ResultContent">분석 중...</div>
            </div>
        </div>
    </div>
    
    <div class="footer">
        <button class="result-check-button" id="resultCheckButton" onclick="applyAnalysisResult()">분석 결과 적용하기</button>
    </div>

    <!-- 상세 보기 패널 (분석 결과) -->
    <div class="detail-panel" id="detailPanel" aria-hidden="true">
        <div class="detail-header">
            <h2 style="margin:auto; font-size:20px; text-align: center; color:#203a59;">분석 상세</h2>
        </div>
        
        <!-- 상세 진행 카드 -->
        <div class="detail-progress-card">
            <div class="detail-progress-percentage" id="detailProgressPercentage">0%</div>
            <div class="detail-progress-text" id="detailProgressText">분석을 시작하고 있습니다...</div>
        </div>
        
        <!-- 진행 타임라인 -->
        <div id="detailTimeline">
            <div style="border: none; color: black;" class="krds-accordion">
                <div class="timeline-item" id="tl-step-1">
                    <div id="accordionItem01" class="accordion-item" style="width: 100%;">
                        <h5 class="accordion-header"><button disabled type="button" id="accordionHeaderSample01"
                            class="btn-accordion" aria-controls="accordionCollapseSample01">
                            <div class="status-icon info" id="step1-icon">
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <rect width="20" height="20" rx="10" transform="matrix(1 0 0 -1 0 20)" fill="#0B78CB"/>
                                    <path d="M9.89922 7.44102C10.562 7.44102 11.0992 6.90376 11.0992 6.24102C11.0992 5.57827 10.562 5.04102 9.89922 5.04102C9.23648 5.04102 8.69922 5.57827 8.69922 6.24102C8.69922 6.90376 9.23648 7.44102 9.89922 7.44102Z" fill="white"/>
                                    <path d="M8.39922 8.43115C8.28876 8.43115 8.19922 8.5207 8.19922 8.63115V9.43115C8.19922 9.54161 8.28876 9.63115 8.39922 9.63115H9.10078C9.21124 9.63115 9.30078 9.7207 9.30078 9.83115V13.5938H8.2C8.08954 13.5938 8 13.6833 8 13.7938V14.5937C8 14.7042 8.08954 14.7937 8.2 14.7937H11.8C11.9105 14.7937 12 14.7042 12 14.5937V13.7937C12 13.6833 11.9105 13.5938 11.8 13.5938H11.1008V8.63115C11.1008 8.5207 11.0112 8.43115 10.9008 8.43115H8.39922Z" fill="white"/>
                                </svg>
                            </div>
                            <span>이미지 분석</span>
                        </button></h5>
                        <div id="accordionCollapseSample01" class="accordion-collapse collapse" 
                            aria-labelledby="accordionHeaderSample01">
                        <div class="accordion-body"></div>
                        </div>
                    </div>
                </div>
                
                <div class="timeline-item" id="tl-step-2">
                    <div id="accordionItem02" class="accordion-item" style="width: 100%;">
                        <h5 class="accordion-header"><button disabled type="button" id="accordionHeaderSample02"
                            class="btn-accordion" aria-controls="accordionCollapseSample02">
                            <div class="status-icon info" id="step2-icon">
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <rect width="20" height="20" rx="10" transform="matrix(1 0 0 -1 0 20)" fill="#0B78CB"/>
                                    <path d="M9.89922 7.44102C10.562 7.44102 11.0992 6.90376 11.0992 6.24102C11.0992 5.57827 10.562 5.04102 9.89922 5.04102C9.23648 5.04102 8.69922 5.57827 8.69922 6.24102C8.69922 6.90376 9.23648 7.44102 9.89922 7.44102Z" fill="white"/>
                                    <path d="M8.39922 8.43115C8.28876 8.43115 8.19922 8.5207 8.19922 8.63115V9.43115C8.19922 9.54161 8.28876 9.63115 8.39922 9.63115H9.10078C9.21124 9.63115 9.30078 9.7207 9.30078 9.83115V13.5938H8.2C8.08954 13.5938 8 13.6833 8 13.7938V14.5937C8 14.7042 8.08954 14.7937 8.2 14.7937H11.8C11.9105 14.7937 12 14.7042 12 14.5937V13.7937C12 13.6833 11.9105 13.5938 11.8 13.5938H11.1008V8.63115C11.1008 8.5207 11.0112 8.43115 10.9008 8.43115H8.39922Z" fill="white"/>
                                </svg>
                            </div>
                            <span>짐 인식 및 분류</span>
                        </button></h5>
                        <div id="accordionCollapseSample02" class="accordion-collapse collapse" 
                            aria-labelledby="accordionHeaderSample02">
                        <div class="accordion-body"></div>
                        </div>
                    </div>
                </div>
                <div class="timeline-item" id="tl-step-3">
                    <div id="accordionItem03" class="accordion-item" style="width: 100%;">
                        <h5 class="accordion-header"><button disabled type="button" id="accordionHeaderSample03"
                            class="btn-accordion" aria-controls="accordionCollapseSample03">
                            <div class="status-icon info" id="step3-icon">
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <rect width="20" height="20" rx="10" transform="matrix(1 0 0 -1 0 20)" fill="#0B78CB"/>
                                    <path d="M9.89922 7.44102C10.562 7.44102 11.0992 6.90376 11.0992 6.24102C11.0992 5.57827 10.562 5.04102 9.89922 5.04102C9.23648 5.04102 8.69922 5.57827 8.69922 6.24102C8.69922 6.90376 9.23648 7.44102 9.89922 7.44102Z" fill="white"/>
                                    <path d="M8.39922 8.43115C8.28876 8.43115 8.19922 8.5207 8.19922 8.63115V9.43115C8.19922 9.54161 8.28876 9.63115 8.39922 9.63115H9.10078C9.21124 9.63115 9.30078 9.7207 9.30078 9.83115V13.5938H8.2C8.08954 13.5938 8 13.6833 8 13.7938V14.5937C8 14.7042 8.08954 14.7937 8.2 14.7937H11.8C11.9105 14.7937 12 14.7042 12 14.5937V13.7937C12 13.6833 11.9105 13.5938 11.8 13.5938H11.1008V8.63115C11.1008 8.5207 11.0112 8.43115 10.9008 8.43115H8.39922Z" fill="white"/>
                                </svg>
                            </div>
                            <span>차량 공간 계산</span>
                        </button></h5>
                        <div id="accordionCollapseSample03" class="accordion-collapse collapse" 
                            aria-labelledby="accordionHeaderSample03">
                        <div class="accordion-body"></div>
                        </div>
                    </div>
                </div>
                <div class="timeline-item" id="tl-step-4">
                    <div id="accordionItem04" class="accordion-item" style="width: 100%;">
                        <h5 class="accordion-header"><button disabled type="button" id="accordionHeaderSample04"
                            class="btn-accordion" aria-controls="accordionCollapseSample04">
                            <div class="status-icon info" id="step4-icon">
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <rect width="20" height="20" rx="10" transform="matrix(1 0 0 -1 0 20)" fill="#0B78CB"/>
                                    <path d="M9.89922 7.44102C10.562 7.44102 11.0992 6.90376 11.0992 6.24102C11.0992 5.57827 10.562 5.04102 9.89922 5.04102C9.23648 5.04102 8.69922 5.57827 8.69922 6.24102C8.69922 6.90376 9.23648 7.44102 9.89922 7.44102Z" fill="white"/>
                                    <path d="M8.39922 8.43115C8.28876 8.43115 8.19922 8.5207 8.19922 8.63115V9.43115C8.19922 9.54161 8.28876 9.63115 8.39922 9.63115H9.10078C9.21124 9.63115 9.30078 9.7207 9.30078 9.83115V13.5938H8.2C8.08954 13.5938 8 13.6833 8 13.7938V14.5937C8 14.7042 8.08954 14.7937 8.2 14.7937H11.8C11.9105 14.7937 12 14.7042 12 14.5937V13.7937C12 13.6833 11.9105 13.5938 11.8 13.5938H11.1008V8.63115C11.1008 8.5207 11.0112 8.43115 10.9008 8.43115H8.39922Z" fill="white"/>
                                </svg>
                            </div>
                            <span>최적 배치 생성</span>
                        </button></h5>
                        <div id="accordionCollapseSample04" class="accordion-collapse collapse" 
                            aria-labelledby="accordionHeaderSample04">
                        <div class="accordion-body"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <button class="detail-back-btn" onclick="closeDetailPanel()">이전 화면</button>
    </div>
    
    <!-- 하드웨어 제어 확인 다이얼로그 -->
    <div class="hardware-confirm-modal" id="hardwareConfirmModal" style="display: none;">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3>분석 결과 적용 확인</h3>
            </div>
            <div class="modal-body">
                <p>차량 시트 배치 분석 결과를 실제 하드웨어에 적용하시겠습니까?</p>
                <!-- <div class="placement-code-preview" id="placementCodePreview">
                    <strong>배치 코드:</strong> <span id="placementCodeValue">로딩 중...</span>
                </div> -->
                <div class="warning-message">
                    ⚠️ 이 작업은 실제 하드웨어를 제어합니다.
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" onclick="cancelHardwareControl()">취소</button>
                <button class="btn-confirm" onclick="confirmHardwareControl()">적용하기</button>
            </div>
        </div>
    </div>
    
    <!-- 하드웨어 제어 진행 상황 모달 -->
    <div class="hardware-progress-modal" id="hardwareProgressModal" style="display: none;">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3>하드웨어 제어 진행</h3>
            </div>
            <div class="modal-body">
                <!-- <div class="progress-container">
                    <div class="progress-bar-hw" id="hardwareProgressBar">
                        <div class="progress-fill-hw" id="hardwareProgressFill"></div>
                    </div>
                    <div class="progress-text" id="hardwareProgressText">하드웨어 연결 중...</div>
                </div> -->
                <div class="hardware-status" id="hardwareStatus">
                    <div class="status-item">
                        <span class="status-icon" id="connectionStatus">⏳</span>
                        <span>실행이 완료되었습니다</span>
                    </div>
                    <!-- <div class="status-item">
                        <span class="status-icon" id="commandStatus">⏳</span>
                        <span>명령 전송</span>
                    </div>
                    <div class="status-item">
                        <span class="status-icon" id="executionStatus">⏳</span>
                        <span>실행 완료</span>
                    </div> -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-close" onclick="closeHardwareProgress()" id="closeProgressBtn" style="display: none;">닫기</button>
                <button class="btn-retry" onclick="retryHardwareControl()" id="retryBtn" style="display: none;">확인</button>
            </div>
        </div>
    </div>
    
    <script src="/static/js/mobile/progress.js"></script>
    <script>
        // KRDS 아코디언 초기화 오류 방지
        document.addEventListener('DOMContentLoaded', function() {
            // KRDS 라이브러리가 로드된 후 아코디언 초기화
            if (typeof window.krds !== 'undefined' && window.krds.accordion) {
                try {
                    // 아코디언 요소들이 존재하는지 확인 후 초기화
                    const accordionElements = document.querySelectorAll('.krds-accordion');
                    if (accordionElements.length > 0) {
                        window.krds.accordion.init();
                    }
                } catch (error) {
                    console.warn('KRDS 아코디언 초기화 중 오류:', error);
                }
            }
        });
    </script>
    <script defer src="https://cdn.jsdelivr.net/npm/krds-uiux@1.0.3/resources/cdn/krds.min.js"></script>
</body>
</html>